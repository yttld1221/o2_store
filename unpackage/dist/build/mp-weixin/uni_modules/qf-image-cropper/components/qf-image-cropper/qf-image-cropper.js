(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["uni_modules/qf-image-cropper/components/qf-image-cropper/qf-image-cropper"],{"280a":function(t,e,i){"use strict";i.r(e);var a=i("a59d"),s=i("d52e");for(var h in s)["default"].indexOf(h)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(h);i("8c05");var o=i("f0c5"),n=i("7265"),r=Object(o["a"])(s["default"],a["b"],a["c"],!1,null,"97574f30",null,!1,a["a"],void 0);"function"===typeof n["a"]&&Object(n["a"])(r),e["default"]=r.exports},7265:function(t,e,i){"use strict";e["a"]=function(t){t.options.wxsCallMethods||(t.options.wxsCallMethods=[]),t.options.wxsCallMethods.push("dataChange")}},"8c05":function(t,e,i){"use strict";var a=i("b197"),s=i.n(a);s.a},a59d:function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return s})),i.d(e,"a",(function(){}));var a=function(){var t=this.$createElement;this._self._c},s=[]},b197:function(t,e,i){},d52e:function(t,e,i){"use strict";i.r(e);var a=i("e9b2"),s=i.n(a);for(var h in a)["default"].indexOf(h)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(h);e["default"]=s.a},e9b2:function(t,e,i){"use strict";(function(t){var a=i("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=a(i("9523"));function h(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function o(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?h(Object(i),!0).forEach((function(e){(0,s.default)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):h(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var n={name:"qf-image-cropper",options:{styleIsolation:"isolated"},props:{src:{type:String,default:""},width:{type:Number,default:300},height:{type:Number,default:300},showBorder:{type:Boolean,default:!0},showGrid:{type:Boolean,default:!0},showAngle:{type:Boolean,default:!0},areaScale:{type:Number,default:.3},maxScale:{type:Number,default:5},bounce:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!0},choosable:{type:Boolean,default:!0},angleSize:{type:Number,default:20},angleBorderWidth:{type:Number,default:2},radius:{type:Number,default:0},fileType:{type:String,default:"png"},delay:{type:Number,default:1e3}},emits:["crop"],data:function(){return{maskList:[{id:"crop-mask-block-1"},{id:"crop-mask-block-2"},{id:"crop-mask-block-3"},{id:"crop-mask-block-4"}],gridList:[{id:"crop-grid-1"},{id:"crop-grid-2"},{id:"crop-grid-3"},{id:"crop-grid-4"}],angleList:[{id:"crop-angle-1"},{id:"crop-angle-2"},{id:"crop-angle-3"},{id:"crop-angle-4"}],imgSrc:"",imgWidth:300,imgHeight:300,widthPercent:75,heightPercent:75,area:{},oldWidth:0,oldHeight:0,sys:t.getSystemInfoSync(),scaleWidth:0,scaleHeight:0,rotate:0,offsetX:0,offsetY:0,use2d:!1,canvansWidth:0,canvansHeight:0}},computed:{initData:function(){return{timestamp:(new Date).getTime(),area:o(o({},this.area),{},{bounce:this.bounce,showBorder:this.showBorder,showGrid:this.showGrid,showAngle:this.showAngle,angleSize:this.angleSize,angleBorderWidth:this.angleBorderWidth,minScale:this.areaScale,widthPercent:this.widthPercent,heightPercent:this.heightPercent,radius:this.radius}),sys:this.sys,img:{maxScale:this.maxScale,src:this.imgSrc,width:this.oldWidth,height:this.oldHeight,oldWidth:this.oldWidth,oldHeight:this.oldHeight}}},imgProps:function(){return{width:this.width,height:this.height,src:this.src}}},watch:{imgProps:{handler:function(t){this.imgWidth=Number(t.width)||300,this.imgHeight=Number(t.height)||300;var e=this.imgWidth,i=this.imgHeight,a=Math.max(e,i),s=1;a>1365&&(s=1365/a),this.canvansWidth=e*s,this.canvansHeight=i*s,this.use2d=!0,this.initArea(),t.src&&this.initImage(t.src)},immediate:!0}},methods:{dataChange:function(t){this.scaleWidth=t.width,this.scaleHeight=t.height,this.rotate=t.rotate,this.offsetX=t.x,this.offsetY=t.y},initArea:function(){this.sys.offsetBottom=t.upx2px(100)+this.sys.safeAreaInsets.bottom,this.sys.windowTop=0,this.sys.navigation=!0;var e=this.widthPercent,i=this.heightPercent;this.imgWidth>this.imgHeight?i=i*this.imgHeight/this.imgWidth:this.imgWidth<this.imgHeight&&(e=e*this.imgWidth/this.imgHeight);var a=this.sys.windowWidth>this.sys.windowHeight?this.sys.windowHeight:this.sys.windowWidth,s=a*e/100,h=a*i/100,o=(this.sys.windowWidth-s)/2,n=o+s,r=(this.sys.windowHeight+this.sys.windowTop-this.sys.offsetBottom-h)/2,c=this.sys.windowHeight+this.sys.windowTop-this.sys.offsetBottom-r;this.area={width:s,height:h,left:o,right:n,top:r,bottom:c},this.scaleWidth=s,this.scaleHeight=h},chooseImage:function(){var e=this;t.chooseMedia?t.chooseMedia({count:1,mediaType:["image"],success:function(t){e.resetData(),e.initImage(t.tempFiles[0].tempFilePath)}}):t.chooseImage({count:1,success:function(t){e.resetData(),e.initImage(t.tempFiles[0].path)}})},resetData:function(){this.imgSrc="",this.rotate=0,this.offsetX=0,this.offsetY=0,this.initArea()},initImage:function(e){var i=this;t.getImageInfo({src:e,success:function(t){i.imgSrc=t.path;var e=t.width/t.height,a=i.area.width/i.area.height;e>1?e>=a?i.scaleWidth=i.scaleHeight/t.height*i.scaleWidth*(t.width/i.scaleWidth):i.scaleHeight=t.height*i.scaleWidth/t.width:e<=a?i.scaleHeight=i.scaleWidth/t.width*i.scaleHeight/(i.scaleHeight/t.height):i.scaleWidth=t.width*i.scaleHeight/t.height,i.oldWidth=i.scaleWidth,i.oldHeight=i.scaleHeight},fail:function(t){console.error(t)}})},drawClipImage:function(t,e,i,a){if(e>0){t.save(),t.beginPath();var s=this.canvansWidth,h=this.canvansHeight;s===h&&e>=s/2?t.arc(s/2,h/2,s/2,0,2*Math.PI):(s!==h&&(e=Math.min(s/2,h/2,e)),t.moveTo(e,0),t.arcTo(s,0,s,h,e),t.arcTo(s,h,0,h,e),t.arcTo(0,h,0,0,e),t.arcTo(0,0,s,0,e),t.closePath()),t.clip(),a&&a(!0),t.restore()}else a&&a(!1)},drawRotateImage:function(t,e,i){if(0!==e){var a=this.scaleWidth*i/2,s=this.scaleHeight*i/2;t.translate(a,s),t.rotate(e*Math.PI/180),t.translate(-a,-s)}},drawImage:function(t,e,i){var a=this,s=this.canvansWidth/this.area.width;this.drawClipImage(t,this.radius,s,(function(){a.drawRotateImage(t,a.rotate,s);var i=a.rotate/90;t.drawImage(e,[a.offsetX-a.area.left,a.offsetY-a.area.top,-(a.offsetX-a.area.left),-(a.offsetY-a.area.top)][i]*s,[a.offsetY-a.area.top,-(a.offsetX-a.area.left),-(a.offsetY-a.area.top),a.offsetX-a.area.left][i]*s,a.scaleWidth*s,a.scaleHeight*s)}))},draw2DImage:function(e,i,a,s){var h=this;if(e){var o=e.createImage();o.onload=function(){h.drawImage(i,o),s&&setTimeout(s,h.delay)},o.onerror=function(e){console.error(e),t.hideLoading()},o.src=a}else this.drawImage(i,a),setTimeout((function(){i.draw(!1,s)}),200)},canvasToTempFilePath:function(e,i){var a=this;t.canvasToTempFilePath({canvas:e,canvasId:i,x:0,y:0,width:this.canvansWidth,height:this.canvansHeight,destWidth:this.imgWidth,destHeight:this.imgHeight,fileType:this.fileType,success:function(t){a.handleImage(t.tempFilePath)},fail:function(e){t.hideLoading(),t.showToast({title:"裁剪失败，生成图片异常！",icon:"none"})}},this)},cropClick:function(){var e=this;if(t.showLoading({title:"裁剪中...",mask:!0}),!this.use2d){var i=t.createCanvasContext("imgCanvas",this);return i.clearRect(0,0,this.canvansWidth,this.canvansHeight),void this.draw2DImage(null,i,this.imgSrc,(function(){e.canvasToTempFilePath(null,"imgCanvas")}))}var a=t.createSelectorQuery().in(this);a.select("#imgCanvas").fields({node:!0,size:!0}).exec((function(i){var a=i[0].node,s=t.getSystemInfoSync().pixelRatio;a.width=i[0].width*s,a.height=i[0].height*s;var h=a.getContext("2d");h.scale(s,s),h.clearRect(0,0,e.canvansWidth,e.canvansHeight),e.draw2DImage(a,h,e.imgSrc,(function(){e.canvasToTempFilePath(a)}))}))},handleImage:function(e){t.hideLoading(),this.$emit("crop",{tempFilePath:e})}}};e.default=n}).call(this,i("543d")["default"])}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'uni_modules/qf-image-cropper/components/qf-image-cropper/qf-image-cropper-create-component',
    {
        'uni_modules/qf-image-cropper/components/qf-image-cropper/qf-image-cropper-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("280a"))
        })
    },
    [['uni_modules/qf-image-cropper/components/qf-image-cropper/qf-image-cropper-create-component']]
]);
